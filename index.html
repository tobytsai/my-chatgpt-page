# frame_only_quote.py
# -*- coding: utf-8 -*-

from dataclasses import dataclass
from typing import Dict, Tuple

CM_PER_INCH = 2.54

@dataclass
class Padding:
    top: float
    bottom: float
    left: float
    right: float

    @property
    def v_add(self) -> float:
        return self.top + self.bottom

    @property
    def h_add(self) -> float:
        return self.left + self.right

def cm_to_inch(x_cm: float) -> float:
    return x_cm / CM_PER_INCH

def outer_size_cm(w_cm: float, h_cm: float, pad: Padding) -> Tuple[float, float]:
    """回傳(外寬cm, 外高cm) = 畫心 + 內襯預留"""
    return w_cm + pad.h_add, h_cm + pad.v_add

def perimeter_inch(outer_w_cm: float, outer_h_cm: float) -> float:
    """外框周長（英吋）"""
    per_cm = 2 * (outer_w_cm + outer_h_cm)
    return cm_to_inch(per_cm)

# =========================
# 內襯尺寸表/規則
# =========================

PAD_0 = Padding(0, 0, 0, 0)
PAD_10_ALL = Padding(10, 10, 10, 10)

def pad_from_total(updown_total: float, leftright_total: float, split_total: bool = True) -> Padding:
    """
    你的表寫「上下X、左右Y」：
    - split_total=True  → 視為「總留白」：上=下=X/2，左=右=Y/2（較常見）
    - split_total=False → 視為「各邊」：上=下=X，左=右=Y
    """
    if split_total:
        return Padding(updown_total/2, updown_total/2, leftright_total/2, leftright_total/2)
    return Padding(updown_total, updown_total, leftright_total, leftright_total)

# 水墨|書法一般裱框（依指定尺寸）
CALLIGRAPHY_FRAME_TABLE: Dict[Tuple[float, float], Padding] = {
    (20, 35): pad_from_total(10, 6),
    (35, 70): pad_from_total(10, 6),
    (45, 70): pad_from_total(12, 6),
    (70, 70): pad_from_total(7, 7),
    (35, 138): pad_from_total(15, 6),
    (50, 100): pad_from_total(15, 7),
    (70, 138): pad_from_total(15, 7),
    (90, 180): pad_from_total(30, 9),
    (120, 240): pad_from_total(40, 12),
}

# 水墨|書法裱立體框（直橫不同）
CALLIGRAPHY_SHADOWBOX_VERTICAL = pad_from_total(10, 6)   # 直式：上下10 左右6（總留白拆半）
CALLIGRAPHY_SHADOWBOX_HORIZONTAL = pad_from_total(6, 10) # 橫式：上下6 左右10（總留白拆半）

# 水墨|書法裱捲軸（依指定尺寸）
CALLIGRAPHY_SCROLL_TABLE: Dict[Tuple[float, float], Padding] = {
    (20, 35): pad_from_total(40, 6),
    (35, 70): pad_from_total(35, 6),
    (45, 70): pad_from_total(35, 6),
    (70, 70): pad_from_total(40, 7),
    (35, 138): pad_from_total(35, 6),
    (50, 100): pad_from_total(35, 7),
    (70, 138): pad_from_total(35, 7),
    (90, 180): pad_from_total(40, 9),
    (120, 240): pad_from_total(45, 12),
}

# 無框畫：水墨書法裱綾布做無框畫
CANVASLESS_CALLIGRAPHY_BROCADE = pad_from_total(18, 9)

# 其他類別：大多是 0 或 10/10
CATEGORY_PADDING_RULES: Dict[str, Padding] = {
    # 拼圖框
    "拼圖框-一般框+冷裱熱壓": PAD_0,
    "拼圖框-一般框+壓克力": PAD_0,
    "拼圖框-圖壓框": PAD_0,
    "拼圖框-立體框": PAD_10_ALL,

    # 油畫/膠彩/壓克力（已有布架/板架）
    "油畫膠彩壓克力-直接裝框": PAD_0,
    "油畫膠彩壓克力-一般框+壓克力": PAD_0,
    "油畫膠彩壓克力-立體框": PAD_10_ALL,

    # 水彩/素描/版畫/海報/照片/證書
    "紙類-一般框": PAD_0,
    "紙類-立體框": PAD_10_ALL,

    # 絲巾/唐卡/報紙/薄海報
    "軟材-一般框": PAD_0,
    "軟材-立體框": PAD_10_ALL,

    # 球衣/應援毛巾/紀念服
    "服飾-一般框": PAD_0,
    "服飾-立體框": PAD_10_ALL,

    # 十字繡/鑽石貼
    "十字繡鑽石貼-一般框+壓克力": PAD_0,

    # 無框畫
    "無框畫-畫布類繃布架": PAD_0,
    "無框畫-油畫布輸出含繃布架": PAD_0,
    "無框畫-水墨書法畫心做無框畫": PAD_0,
    "無框畫-水墨書法裱綾布做無框畫": CANVASLESS_CALLIGRAPHY_BROCADE,

    # 立體作品
    "立體作品-各類": PAD_10_ALL,
}

def get_padding(choice: str, w_cm: float, h_cm: float) -> Padding:
    """依選項取得 padding。水墨類走尺寸表；其他走固定規則。"""
    orientation = "直式" if h_cm >= w_cm else "橫式"

    if choice == "水墨書法-一般裱框(依尺寸表)":
        key = (min(w_cm, h_cm), max(w_cm, h_cm))
        if key not in CALLIGRAPHY_FRAME_TABLE:
            raise ValueError(f"水墨書法一般裱框找不到尺寸：{key}（請確認是否為表內規格或改用自訂）")
        return CALLIGRAPHY_FRAME_TABLE[key]

    if choice == "水墨書法-裱立體框(直橫不同)":
        return CALLIGRAPHY_SHADOWBOX_VERTICAL if orientation == "直式" else CALLIGRAPHY_SHADOWBOX_HORIZONTAL

    if choice == "水墨書法-裱捲軸(依尺寸表)":
        key = (min(w_cm, h_cm), max(w_cm, h_cm))
        if key not in CALLIGRAPHY_SCROLL_TABLE:
            raise ValueError(f"水墨書法捲軸找不到尺寸：{key}（請確認是否為表內規格或改用自訂）")
        return CALLIGRAPHY_SCROLL_TABLE[key]

    if choice == "自訂內襯(手動輸入上下左右)":
        raise RuntimeError("自訂內襯由主程式讀取，不應呼叫 get_padding")

    if choice not in CATEGORY_PADDING_RULES:
        raise ValueError("未知選項")
    return CATEGORY_PADDING_RULES[choice]

def main():
    print("=== 裱框費用計算（只算外框周長 × 單價）===\n")
    w = float(input("請輸入作品『寬』(cm): ").strip())
    h = float(input("請輸入作品『高』(cm): ").strip())

    print("\n請選擇作品類型/框法（會自動套用內襯預留）")
    options = list(CATEGORY_PADDING_RULES.keys()) + [
        "水墨書法-一般裱框(依尺寸表)",
        "水墨書法-裱立體框(直橫不同)",
        "水墨書法-裱捲軸(依尺寸表)",
        "自訂內襯(手動輸入上下左右)",
    ]
    for i, opt in enumerate(options, 1):
        print(f"{i:>2}. {opt}")
    idx = int(input("輸入編號: ").strip())
    choice = options[idx - 1]

    if choice == "自訂內襯(手動輸入上下左右)":
        top = float(input("上預留(cm): ").strip())
        bottom = float(input("下預留(cm): ").strip())
        left = float(input("左預留(cm): ").strip())
        right = float(input("右預留(cm): ").strip())
        pad = Padding(top, bottom, left, right)
    else:
        pad = get_padding(choice, w, h)

    # 你要的「英寸大小」
    ow_cm, oh_cm = outer_size_cm(w, h, pad)
    ow_in, oh_in = cm_to_inch(ow_cm), cm_to_inch(oh_cm)

    print("\n輸入框單價（以外框周長計價）")
    price_per_inch = float(input("外框單價（元/英吋周長）: ").strip())

    per_in = perimeter_inch(ow_cm, oh_cm)
    cost = per_in * price_per_inch

    print("\n================= 結果 =================")
    print(f"畫心尺寸(cm)：{w:.2f} × {h:.2f}")
    print(f"內襯預留(cm)：上{pad.top} 下{pad.bottom} 左{pad.left} 右{pad.right}")
    print(f"內容物外尺寸(cm)：{ow_cm:.2f} × {oh_cm:.2f}")
    print(f"內容物外尺寸(in)：{ow_in:.2f} × {oh_in:.2f}")
    print(f"外框周長(in)：2×(外寬+外高) = {per_in:.2f} in")
    print(f"裱框費用：周長(in) × 單價 = {per_in:.2f} × {price_per_inch:.2f} = {cost:.2f}")
    print("========================================\n")

if __name__ == "__main__":
    main()
